  <%- if @track_script or @collect_exported -%>
  }
  <%- end -%>

  <%- if @track_interface -%>
  track_interface {
  <%- Array(@track_interface).each do |interface| -%>
    <%= interface %>
  <%- end -%>
  }
  <%- end -%>

  <%- if @virtual_ipaddress -%>
  virtual_ipaddress {
  <%- if @virtual_ipaddress.class == Hash -%>
    <%- vips = [ @virtual_ipaddress ] -%>
  <%- else -%>
    <%- vips = @virtual_ipaddress -%>
  <%- end -%>
  <%- Array(vips).each do |ip| -%>
    <%- if ip.class == Hash -%>
      <%- device = ip['dev'] || @virtual_ipaddress_int || @interface -%>
      <%- attrs = Hash[ ip.select { |k,v| ['label', 'brd', 'scope'].include? k } ] -%>
    <%= ip['ip'] %> dev <%= device %> <%= attrs.sort_by{ |k,v| k }.entries.join ' ' %>
    <%- else -%>
    <%= ip %> dev <%= @virtual_ipaddress_int || @interface %>
    <%- end -%>
  <%- end -%>
  }
  <%- end -%>

  <%- if @virtual_ipaddress_excluded -%>
  virtual_ipaddress_excluded {
  <%- if @virtual_ipaddress_excluded.class == Hash -%>
    <%- vips = [ @virtual_ipaddress_excluded ] -%>
  <%- else -%>
    <%- vips = @virtual_ipaddress_excluded -%>
  <%- end -%>
  <%- vips.each do |ip| -%>
    <%- if ip.class == Hash -%>
      <%- device = ip['dev'] || @virtual_ipaddress_int || @interface -%>
      <%- attrs = Hash[ ip.select { |k,v| ['label', 'brd', 'scope'].include? k } ] -%>
      <%= ip['ip'] %> dev <%= device %> <%= attrs.sort_by{ |k,v| k }.entries.join ' ' %>

    <%- else -%>
      <%= ip %> dev <%= @virtual_ipaddress_int || @interface %>
    <%- end -%>
  <%- end -%>
  }
  <%- end -%>

  <%- if @virtual_routes -%>
  virtual_routes {
  <%- if @virtual_routes.class == Hash -%>
    <%- vroutes = [ @virtual_routes ] -%>
  <%- else -%>
    <%- vroutes = @virtual_routes -%>
  <%- end -%>
  <%- vroutes.each do |route| -%>
    <%- attrs = Hash[ route.select { |k,v| ['src', 'to', 'via', 'dev', 'scope'].include? k } ] -%>
    <%= route['route'] %>  <%= attrs.sort_by{ |k,v| k }.entries.join ' ' %>
  <%- end -%>
  }
  <%- end -%>

  <%- if @multicast_source_ip -%>
  mcast_src_ip <%= @multicast_source_ip %>
  <%- end -%>
  <%- if @unicast_source_ip -%>
  unicast_src_ip <%= @unicast_source_ip %>
  <%- end -%>

  <%- if @unicast_peers -%>
  unicast_peer {
  <%- @unicast_peers.each do |peer| -%>
    <%= peer %>
  <%- end -%>
  }
  <%- end -%>

}
