group <%= @_name %> {

  <%- if @fwmark -%>
  virtual_server fwmark <%= @fwmark %>
  <%- else -%>
  virtual_server <%= @ip_address %> <%= @port %>
  <%- end -%>

  <%- if @delay_loop -%>
  delay_loop <%= @delay_loop %>
  <%- end -%>
  lb_algo <%= @lb_algo %>
  <%- if @lb_kind -%>
  lb_kind <%= @lb_kind %>
  <%- end -%>
  <%- if @persistence_timeout %>
  persistence_timeout <%= @persistence_timeout %>
  <%- end -%>
  <%- if @ha_suspend -%>
  ha_suspend
  <%- end -%>
  <%- if @virtualhost -%>
  virtualhost <%= @virtualhost %>
  <%- end -%>
  <%- if @alpha -%>
  alpha
  <%- end -%>
  <%- if @omega -%>
  omega
  <%- end -%>
  <%- if @quorum -%>
  quorum <%= @quorum %>
  <%- end -%>
  <%- if @hysteresis -%>
  hysteresis <%= @hysteresis %>
  <%- end -%>
  protocol <%= @protocol %>
  <%- if @sorry_server -%>
  sorry_server <%= @sorry_server['ip_address'] %> <%= @sorry_server['port'] %>
  <%- end -%>

  <%- if @real_servers -%>
    <%- Array(@real_servers).each do |rs| -%>
      <%- rs_port = rs['port'] || @port -%>
  real_server <%= rs['ip_address'] %> <%= rs_port %> {
      <%- if @tcp_check -%>
    TCP_CHECK {
      connect_port <%= rs_port %>
      connect_timeout <%= @tcp_check['connect_timeout'] %>
    }
      <%- end -%>
      <%- if @http_get -%>
    <% if @http_get['use_ssl'] %>SSL_GET<% else %>HTTP_GET<% end %> {
      connect_port <%= rs_port %>
      connect_timeout <%= @http_get['connect_timeout'] %>
      <%- for @url in @http_get['urls'] -%>
      url {
        path <%= @url['path'] %>
        digest <%= @url['digest'] %>
        <%- if @url['status_code'] -%>
        status_code <%= @url['status_code'] %>
        <%- end -%>
      }
      <%- end -%>
    }
      <%- end -%>
      <%- if @misc_check -%>
    MISC_CHECK {
      misc_timeout <%= @misc_check['timeout'] %>
      misc_path <%= @misc_check['path'] %>
      <%- if @misc_check['dynamic'] -%>
      misc_dynamic
      <%- end -%>
      user <%= @misc_check['user'] %>
    }
      <%- end -%>
  }
    <%- end -%>

  <%- end -%>

